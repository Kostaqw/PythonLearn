<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="~/js/ckeditor5/ckeditor.js"></script>
    <script src="https://kit.fontawesome.com/c2c8ebeca3.js" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="js/slick-1.8.1/slick/slick.css" />
    <title>Обучение python</title>
</head>

<body>
    <div id="toTop"><i class="fas- fa-chevron-up"></i></div>
    <header class="menu-bar">
        <div class="container">
            <ul class="tabs">
                <li class="tabs__item tabs__item tabs__link--active"><a class="tabs__link" href="#" data-title="one">Курс</a></li>
                <li class="tabs__item"><a class="tabs__link" href="#" data-title="two">Урок</a></li>
                <li class="tabs__item"><a class="tabs__link" href="#" data-title="three">Элемент</a></li>    
            </ul>
            
            <div class="tabs__content" id="one">
                <p>
                    <form method="post" asp-controller="Course" asp-action="CreateCourse">
                        <div class="mb-3">
                            <label for="Name" class="form-label">Название курса</label>
                            <input type="text" class="form-control" id="CourseName" aria-describedby="CourseName">
                        </div>
                         <div class="mb-3">
                            <label for="Description" class="form-label">Описание курса</label>
                            <textarea class="form-control" aria-label="With textarea"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Создать</button>
                    </form>
                </p>
            </div>

            <div class="tabs__content" id="two" >
                <p>
                    <form method="post" asp-controller="Course" asp-action="CreateLesson">    
                        <label for="Name" class="form-label">Для какого курса</label>
                        <select class="form-select" aria-label="Default select example">
                            <option value="1">Course1</option>
                            <option value="2">Course2</option>
                            <option value="3">Course3</option>
                        </select>

                        <div class="mb-3">
                            <label for="Name" class="form-label">Название урока</label>
                            <input type="text" class="form-control" id="CourseName" aria-describedby="CourseName">
                        </div>
                            <div class="mb-3">
                            <label for="Description" class="form-label">Описание курса</label>
                            <textarea class="form-control" aria-label="With textarea"></textarea>
                        </div>

                        <div class="text-center">
                            <textarea name="content" id="editor" class="form-control"></textarea>
                        </div>

                        <button type="submit" class="btn btn-primary">Создать</button>
                    </form>
                </p>
            </div>

            <div class="tabs__content" id="three" >
                <p>
                    <form method="post" asp-controller="Course" asp-action="CreateEllement">    
                        
                        <label for="Name" class="form-label">Для какого урока</label>
                        <select class="form-select" aria-label="Default select example">
                            <option value="1">Урок 1</option>
                            <option value="2">Урок 2</option>
                            <option value="3">Урок 3</option>
                        </select>

                        <label for="Name" class="form-label">Тип элемента</label>
                        <select class="form-select element_type" aria-label="Default select example">
                            <option value="theory">Теория</option>
                            <option value="test">Тест</option>
                            <option value="practice">Практическое задание</option>
                        </select>

                        <div class="row mt-3">
                            <div class="theory box">
                                
                                <div class="row mt-3">
                                    <div class="text-center">
                                        <textarea name="content" id="editor" class="form-control"></textarea>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <button type="submit" class="btn btn-primary">Создать блок теории</button>
                                </div>
                            </div>
                            
                            <div class="test box">
                                <div class="row align-items-center mt-3">
                                    <div class="col-xl-4">
                                        <button id="addMultipleChoiceQuestion" class="btn btn-primary">Добавить вопрос с несколькими вариантами ответа</button>
                                    </div>
                                    <div class="col-xl-4">
                                        <button id="addSingleChoiceQuestion" class="btn btn-primary">Добавить вопрос с одним вариантом ответа</button>
                                    </div>
                                    <div class="col-xl-4">
                                        <button type="button" class="btn btn-primary">Добавить вопрос с текстовым ответом</button>
                                    </div>
                                </div>

                                <div class="Questions">
                                    <div class="row align-items-center mt-3">
                                        <div id="questionsContainer"></div>
                                    </div>
                                </div>

                                <div class="row mt-3">
                                    <button id="saveTest" class="btn btn-primary">Сохранить тест</button>
                                </div>
                            </div>

                            <div class="practice box">

                                <label for="Name" class="form-label">задание</label>
                                <div class="row mt-3">
                                    <div class="text-center">
                                        <textarea name="content" id="editor" class="form-control"></textarea>
                                    </div>
                                </div>
                                
                                <label for="Name" class="form-label">Ответ</label>
                                <div class="row mt-3">
                                    <div class="text-center">
                                        <textarea name="content" id="editor" class="form-control"></textarea>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <button type="submit" class="btn btn-primary">Создать блок практики</button>
                                </div>
                            </div>
                        </div>

                    </form>
                </p>
            </div>

        </div>

    </header>

    <section class="about" id="about">
        <div class="container">
            <div class="row">
                <div class="col-xl-10">
                    
                </div>
            </div>
        </div>
    </section>

    
    <footer class="footer" id="contact">
       
    </footer>



    <script src="https://cdn.jsdelivr.net/npm/@@popperjs/core@2.11.6/dist/umd/popper.min.js"
            integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"
            integrity="sha384-mQ93GR66B00ZXjt0YO5KlohRA5SY2XofN4zfuZxLkoj1gXtW8ANNCe9d5Y3eG5eD"
            crossorigin="anonymous"></script>

            <script src="js/jquery-3.6.3.js"></script>
            <script type="text/javascript" src="js/slick-1.8.1/slick/slick.min.js"></script>
    <script src="js/main.js"></script>
    
    <script>
       
       /*
        $(".tabs__content").hide(); // скрываем содержимое всех вкладок
        $(".tabs__content:first").fadeIn(); //показываем содерживмое первой вкладки
        
        $('.tabs__item').on('click', function () {
        $(this).addClass('tabs__link--active').siblings().removeClass('tabs__link--active'); //при клике по текущему элементу добавляем класс и удаляем этот класс у соседнего элемента если он есть
        return false;
        })

        $('.tabs__link').click(function(e) {
            e.preventDefault(); //отменяем дефолтное действие
            $(".tabs__content").hide(); //скрываем контент вкладок
            $('#' + $(this).attr('data-title')).fadeIn(); //показываем вкладку с id соответствующем  содержимому  атрибута data-title текущего элемента
        });


        $(document).ready(function(){
        $("select").change(function(){
        $(this).find("option:selected").each(function(){
            var optionValue = $(this).attr("value");
            if(optionValue){
                $(".box").not("." + optionValue).hide();
                $("." + optionValue).show();
            } else{
                $(".box").hide();
            }
        });
            }).change();
        });

*/
        $(document).ready(function() {
        var questionCounter = 0;

        $('#addSingleChoiceQuestion').click(function() {
            questionCounter++;
            var questionId = 'question' + questionCounter;

            var questionHtml = '<div id="' + questionId + '">' +
            '<input type="text" class="questionInput" placeholder="Введите вопрос">' +
            '<button class="addOption">Добавить вариант ответа</button>' +
            '<button class="removeQuestion">Удалить вопрос</button>' +
            '<div class="optionsContainer"></div>' +
            '</div>';

            $('#questionsContainer').append(questionHtml);

            $('#' + questionId).on('click', '.addOption', function() {
            var optionHtml = '<div>' +
                '<input type="radio" name="' + questionId + '" class="optionRadio">' +
                '<input type="text" class="optionInput" placeholder="Введите вариант ответа">' +
                '<button class="removeOption">Удалить вариант ответа</button>' +
                '</div>';

            $(this).siblings('.optionsContainer').append(optionHtml);
            });

            $('#' + questionId).on('click', '.removeOption', function() {
            $(this).parent().remove();
            });

            $('#' + questionId).on('click', '.removeQuestion', function() {
            $(this).parent().remove();
            });
        });

        $('#addMultipleChoiceQuestion').click(function() {
            questionCounter++;
            var questionId = 'question' + questionCounter;

            var questionHtml = '<div id="' + questionId + '">' +
            '<input type="text" class="questionInput" placeholder="Введите вопрос">' +
            '<button class="addOption">Добавить вариант ответа</button>' +
            '<button class="removeQuestion">Удалить вопрос</button>' +
            '<div class="optionsContainer"></div>' +
            '</div>';

            $('#questionsContainer').append(questionHtml);

            $('#' + questionId).on('click', '.addOption', function() {
            var optionHtml = '<div>' +
                '<input type="checkbox" name="' + questionId + '" class="optionCheckbox">' +
                '<input type="text" class="optionInput" placeholder="Введите вариант ответа">' +
                '<button class="removeOption">Удалить вариант ответа</button>' +
                '</div>';

            $(this).siblings('.optionsContainer').append(optionHtml);
            });

            $('#' + questionId).on('click', '.removeOption', function() {
            $(this).parent().remove();
            });

            $('#' + questionId).on('click', '.removeQuestion', function() {
            $(this).parent().remove();
            });
        });

        $('#saveTest').click(function() {
            var test = {
            questions: []
            };

            $('.questionInput').each(function() {
            var question = {
                text: $(this).val(),
                options: []
            };

            var questionId = $(this).parent().attr('id');
            var isSingleChoice = $(this).siblings('.optionsContainer').find('.optionRadio').length > 0;

            $(this).siblings('.optionsContainer').find('.optionInput').each(function() {
                question.options.push({
                text: $(this).val(),
                isCorrect: isSingleChoice ? $(this).siblings('.optionRadio').is(':checked') : $(this).siblings('.optionCheckbox').is(':checked')
                });
            });

            test.questions.push(question);
            });

            var jsonData = JSON.stringify(test);
            console.log(jsonData);
            // Отправить jsonData на сервер или сохранить в файл
        });
        });


       
    </script>


    
<script>
    class MyUploadAdapter 
    {
        constructor(loader) {
            // The file loader instance to use during the upload. It sounds scary but do not
            // worry — the loader will be passed into the adapter later on in this guide.
            this.loader = loader;
        }
        upload() {
            return this.loader.file
                .then(file => new Promise((resolve, reject) => {
                    this._initRequest();
                    this._initListeners(resolve, reject, file);
                    this._sendRequest(file);
                }));
        }

        // Aborts the upload process.
        abort() {
            if (this.xhr) {
                this.xhr.abort();
            }
        }

        _initRequest() {
            const xhr = this.xhr = new XMLHttpRequest();
            // Note that your request may look different. It is up to you and your editor
            // integration to choose the right communication channel. This example uses
            // a POST request with JSON as a data structure but your configuration
            // could be different.

            xhr.open('POST', '@Url.Action("UplodImage","Article")', true);
            xhr.responseType = 'json';
        }

        _initListeners(resolve, reject, file) {
            const xhr = this.xhr;
            const loader = this.loader;
            const genericErrorText = `Couldn't upload file: ${file.name}.`;

            xhr.addEventListener('error', () => reject(genericErrorText));
            xhr.addEventListener('abort', () => reject());
            xhr.addEventListener('load', () => {
                const response = xhr.response;

                // This example assumes the XHR server's "response" object will come with
                // an "error" which has its own "message" that can be passed to reject()
                // in the upload promise.
                //
                // Your integration may handle upload errors in a different way so make sure
                // it is done properly. The reject() function must be called when the upload fails.
                if (!response || response.error) {
                    return reject(response && response.error ? response.error.message : genericErrorText);
                }

                // If the upload is successful, resolve the upload promise with an object containing
                // at least the "default" URL, pointing to the image on the server.
                // This URL will be used to display the image in the content. Learn more in the
                // UploadAdapter#upload documentation.
                resolve({
                    default: response.url
                });
            });

            // Upload progress when it is supported. The file loader has the #uploadTotal and #uploaded
            // properties which are used e.g. to display the upload progress bar in the editor
            // user interface.
            if (xhr.upload) {
                xhr.upload.addEventListener('progress', evt => {
                    if (evt.lengthComputable) {
                        loader.uploadTotal = evt.total;
                        loader.uploaded = evt.loaded;
                    }
                });
            }
        }

        // More methods.
        // ...

        // Prepares the data and sends the request.
        _sendRequest(file) {
            // Prepare the form data.
            const data = new FormData();
            var folderName= document.getElementById('titleName').value;
            data.append('upload', file);
            data.append('folder', folderName);
            // Important note: This is the right place to implement security mechanisms
            // like authentication and CSRF protection. For instance, you can use
            // XMLHttpRequest.setRequestHeader() to set the request headers containing
            // the CSRF token generated earlier by your application.

            // Send the request.
            this.xhr.send(data);
        }
    }
    function MyCustomUploadAdapterPlugin(editor) {
        editor.plugins.get('FileRepository').createUploadAdapter = (loader) => {
            // Configure the URL to the upload script in your back-end here!
            return new MyUploadAdapter(loader);
        };
    }
    ClassicEditor
        .create(document.querySelector('#editor'), 
        {   extraPlugins: [ MyCustomUploadAdapterPlugin ]})
        .then(editor => { window.editor = editor;  })
        .catch(err => { console.error(err.stack); });
</script>

</body>

</html>